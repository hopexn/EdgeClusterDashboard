<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="GenCracker Admin Panel"/>
    <meta name="author" content=""/>

    <title>摄像头列表</title>

    <link rel="stylesheet" href="/assets/js/jquery-ui/css/no-theme/jquery-ui-1.10.3.custom.min.css">
    <link rel="stylesheet" href="/assets/css/font-icons/entypo/css/entypo.css">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic">
    <link rel="stylesheet" href="/assets/css/bootstrap.css">
    <link rel="stylesheet" href="/assets/css/neon-core.css">
    <link rel="stylesheet" href="/assets/css/neon-theme.css">
    <link rel="stylesheet" href="/assets/css/neon-forms.css">
    <link rel="stylesheet" href="/assets/css/custom.css">

    <script src="/assets/js/jquery-1.11.0.min.js"></script>
    <script src="/assets/js/viewer.js"></script><!-- Viewer.js is required -->
    <link href="/assets/css/viewer.css" rel="stylesheet">
    <script src="/assets/js/jquery-viewer.js"></script>

    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>


    {#    <script>#}
    {#        $.noConflict();#}
    {#    </script>#}

    <!--[if lt IE 9]>
    <script src="/assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body class="page-body  page-fade">

<div class="page-container">
    <!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->
    {% include "slices/sidebar-menu.html" %}

    <div class="main-content">

        <div class="row">
            <div style="text-align: center" class="my-title col-xs-12">摄像头列表</div>
        </div>

        <hr/>

        <!-- hopen -->
        <div class="row">
            {% for url in cam_urls %}
                <div class="col-md-2" style="margin-bottom: 20px">
                    <p> 摄像头 {{ forloop.counter }} </p>
                    <a href="get_camera/{{ forloop.counter }}">
                        <img src="{{ url }}" alt="camera {{ forloop.counter }}"
                             style="width: 100%; height: 100%" \>
                    </a>
                </div>
            {% endfor %}
        </div>
    </div>

</div>

<!-- Imported styles on this page -->
<link rel="stylesheet" href="/assets/js/jvectormap/jquery-jvectormap-1.2.2.css">
<link rel="stylesheet" href="/assets/js/rickshaw/rickshaw.min.css">

<!-- Bottom scripts (common) -->
<script src="/assets/js/gsap/main-gsap.js"></script>
<script src="/assets/js/jquery-ui/js/jquery-ui-1.10.3.minimal.min.js"></script>
<script src="/assets/js/bootstrap.js"></script>
<script src="/assets/js/joinable.js"></script>
<script src="/assets/js/resizeable.js"></script>
<script src="/assets/js/neon-api.js"></script>
<script src="/assets/js/jvectormap/jquery-jvectormap-1.2.2.min.js"></script>


<!-- Imported scripts on this page -->
<script src="/assets/js/jvectormap/jquery-jvectormap-europe-merc-en.js"></script>
<script src="/assets/js/jquery.sparkline.min.js"></script>
<script src="/assets/js/rickshaw/vendor/d3.v3.js"></script>
<script src="/assets/js/rickshaw/rickshaw.min.js"></script>
<script src="/assets/js/raphael-min.js"></script>
<script src="/assets/js/morris.min.js"></script>
<script src="/assets/js/toastr.js"></script>
<script src="/assets/js/neon-chat.js"></script>


<!-- JavaScripts initializations and stuff -->
<script src="/assets/js/neon-custom.js"></script>

</body>

</html>
<script src="https://d3js.org/d3.v4.min.js"></script>

<script>

    function draw_json(url) {
        var svg = d3.select("#svg_canvas"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        var color = d3.scaleOrdinal(d3.schemeCategory10);

        var simulation = d3.forceSimulation()
            .force("link", d3.forceLink().id(function (d) {
                return d.id;
            }))
            .force("charge", d3.forceManyBody())
            .force("center", d3.forceCenter(width / 2, height / 2));

        d3.json(url, function (error, graph) {
            if (error) throw error;

            var link = svg.append("g")
                .attr("class", "links")
                .selectAll("line")
                .data(graph.links)
                .enter().append("line")
                .attr("stroke-width", function (d) {
                    return d.width;
                });

            var node = svg.append("g")
                .attr("class", "nodes")
                .selectAll("g")
                .data(graph.nodes)
                .enter().append("g");


            var circles = node.append("circle")
                .attr("r", function (d) {
                    return d.radius
                })
                .attr("fill", function (d) {
                    return color(d.group * 2 + 1);
                })
                .call(d3.drag()
                    .on("start", dragstarted)
                    .on("drag", dragged)
                    .on("end", dragended));

            var lables = node.append("text").attr("z-index", -1)
                .text("").attr('x', 20).attr('y', 20);

            node.on("mouseover", function (d) {
                d3.select(this)
                    .select('text')
                    .text(function (d) {
                        return d.name;
                    });

                if (d.id.indexOf("cast_") != -1) {
                    //cast_
                    e_type = "cast";
                    e_id = d.id.substring(5);
                } else {
                    //movie_
                    e_type = "movie";
                    e_id = d.id.substring(6);
                }

                if (e_type == "cast") {
                    d3.json("/get_cast_detail/" + e_id, function (error, graph) {
                        d3.select("#info").html(graph.content);
                    });
                } else {
                    d3.json("/get_movie_detail/" + e_id, function (error, graph) {
                        d3.select("#info").html(graph.content);
                    });
                }


            }).on("mouseout", function (d) {
                d3.select(this)
                    .select('text')
                    .text("")
                d3.select("#info").html("")
            }).on("click", function (d) {
                if (d.id.indexOf("cast_") != -1) {
                    //cast_
                    e_type = "cast";
                    e_id = d.id.substring(5);
                } else {
                    //movie_
                    e_type = "movie";
                    e_id = d.id.substring(6);
                }

                if (e_type == "cast") {
                    url = "/get_cast_info/" + e_id;
                } else {
                    url = "/get_movie_info/" + e_id;
                }

                d3.select("svg").html("");
                draw_json(url);
            });


            simulation
                .nodes(graph.nodes)
                .on("tick", ticked);

            simulation.force("link")
                .links(graph.links);

            function ticked() {
                link.attr("x1", function (d) {
                    return d.source.x;
                })
                    .attr("y1", function (d) {
                        return d.source.y;
                    })
                    .attr("x2", function (d) {
                        return d.target.x;
                    })
                    .attr("y2", function (d) {
                        return d.target.y;
                    });

                node.attr("transform", function (d) {
                    return "translate(" + d.x + "," + d.y + ")";
                })
            }


        });

        function dragstarted(d) {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
        }

        function dragended(d) {
            if (!d3.event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    }

    window.onload = draw_json("{{ url | safe }}")


</script>